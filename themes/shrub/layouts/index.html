{{ define "main" }}

<div class="row">
  <div class="col-xl-8">
    <div class="front-page-header pt-xl-4 pt-lg-4 pb-0 sloped">
      <div class="row pt-4 pb-4 pl-4 pr-4">
        <div class="col-xl-5 col-12 mx-auto">

          <div id="front-page-header" class="mx-auto">
            <center id="default-header">
              <h1 class="shrub mb-2 mt-3 text-center"
                style="font-size: 6em; line-height: 0.5;"
              >
                SHRUB
              </h1>
              <h2 class="dosis-semi-bold" style="font-size: 60px; line-height: 0.8;">
                COOP
              </h2>
              <p
              class="text-center mt-3 dosis-semi-bold text-white"
                style="line-height: 1;"
              >
                We’re a cooperative in Edinburgh working
              </p>
              <h3
              class="text-center dosis-semi-bold"
                style="font-size: 2em; line-height: 0.8;"
              >
                FOR A WORLD
              </h3>
              <h1
              class="text-center dosis-semi-bold"
                style="font-size: 3em; line-height: 0.8;"
              >
                WITHOUT
              </h1>
              <h3
              class="text-center dosis-semi-bold"
                style="font-size: 2em; line-height: 0.8;"
              >
                WASTE
              </h3>
            </center>

            {{ range (where .Data.Pages "Type" "working-groups") }}

            <div
              id="{{urlize .Title }}_info"
              class="working-group-synopsis d-none"
            >
              <div class="row pt-0 pl-4 mb-4">
                <div class="container">
                  <h1
                    class="dosis-bold"
                    style="font-size: 38px; padding-bottom: 0; color: {{.Params.colour}};"
                  >
                    {{ .Title }}
                  </h1>

                  <h4 class="text-white dosis-semi-bold">{{ .Params.tagline }}</h4>


                  {{ if .Params.address }}

                    <p class="text-white mb-1">
                      &#127970; {{ .Params.address }}
                    </p>

                  {{ end }}

                  {{ if .Params.times }}
                    <p class="text-white">
                      &#128336; {{ .Params.times }}
                    </p>
                  {{ end }}

                </div>
              </div>
            </div>

            {{ end }}
          </div>
        </div>
        <div class="col-xl-7 col-12 ml-0 mx-auto d-md-block mt-4 mb-5 pb-xl-5 pb-lg-5 mt-xl-0 mb-xl-0">

            <div class="container mb-4">

              <h2 id="carbonCounter" class="dosis-semi-bold text-center text-white">
                So far, we've saved
                <br />
                <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>

              </h2>

            </div>





                <div class="d-flex flex-wrap justify-content-center mb-4 mb-xl-0">

                  {{ range (where .Data.Pages "Type" "working-groups") }}

                      <a
                        class="working_group_link p-1"
                        href="{{.Site.BaseURL}}{{.URL}}"
                        title="{{ .Params.alt }}"

                      >
                        <div class="d-inline p-4 mb-4" id="{{urlize .Title }}">
                          <img alt="{{ .Name }} logo"
                            src="{{ .Params.working_group_logo}}"
                            id="{{urlize .Title }}"
                            class="working-group-icon mx-auto"
                          />
                        </div>
                      </a>



                  {{ end }}

                </div>



        </div>
      </div>
    </div>
    <div id="front-page-map"></div>
  </div>

  <div class="col-xl-4">

    <div class="events-header pt-4 pb-4">
      <div class="container">
        <div class="pl-4 pt-2 text-white links-white">
          {{ .Scratch.Set "eventsTextWhite" "true" }}
          {{ range first 1 (where .Data.Pages "Type" "events") }}

            {{ partial "events-preview.html" . }}

          {{ end }}
        </div>
      </div>
    </div>

    <div class="latest-blog-header sloped pb-5" style="margin-top: -2px;">
      <div class="container">
        <div class="pl-3 pb-xl-4 pb-lg-4 pt-4 text-white links-white">
          {{ range first 1 (where .Data.Pages "Type" "news") }}
            {{- partial "news-preview.html" . -}}
          {{ end }}
        </div>
      </div>
    </div>
  </div>

</div>

<br />

<script>

  $(".working-group-icon").mouseenter(function(){
    $("#default-header").hide();
    $(".working-group-synopsis").addClass("d-none");
    $(".working-group-icon").css("opacity", "0.5");
    $(this).css("opacity", "1");
    $("#" + this.id + "_info").removeClass("d-none");
  })

  $(".working-group-icon").mouseleave(function(){
    $("#default-header").show();
    $("#" + this.id + "_info").addClass("d-none");
    $("#" + this.id + "_info").removeClass("d-none");
    $(".working-group-synopsis").addClass("d-none");
    $(".working-group-icon").css("opacity", "1");
  })

  $.ajax({
    url: "https://murakami.org.uk/api/get/reports/all-time/carbon-saved?key={{ .Site.Params.murakamiCarbonKey }}",
    type: "GET",
    success: function(res) {
      if (!parseFloat(res)) {
        res = (0.0).toFixed(3);
      }
      $("#carbonCounter").html("So far, we've saved <br />" + res + " tonnes of carbon!");
    }
  });

  var centerCoords = [55.9499497,-3.1969465]

  var map = L.map('front-page-map', {zoomControl:false}).setView(centerCoords, 14);

  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
  	attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
  	maxZoom: 18,
  	id: 'mapbox.outdoors',
  	accessToken: '{{ .Site.Params.mapboxKey }}'
  }).addTo(map);

  var markers = [
    {"name":"22 Bread Street", coords: [55.9456658,-3.2066068], "bindTo": ["swapshop", "zero-waste-hub", "food-sharing"]},
    {"name":"13 Guthrie Street", coords: [55.9481442,-3.1906552], "bindTo": ["wee-spoke-hub"]},
    {"name":"17 Guthrie Street", coords: [55.948236,-3.1907144], "bindTo": ["workshops-and-events"]}
  ]



  markers.forEach(function(marker, i){
    markers[i].markerObj = L.marker(markers[i].coords).addTo(map);
    markers[i].markerObj.bindPopup("<p class='font-weight-bold'>" + markers[i].name + "</p>");
    var currentMarker = markers[i].markerObj;
    markers[i].bindTo.forEach(function(group, j){
      $('#' + markers[i].bindTo[j]).on('mouseenter', function(e) {
        // Pan to location when hovering on group
        currentMarker.openPopup();
        map.setView([(markers[i].coords[0] + 0.001), markers[i].coords[1]], 17); // Offset slightly to account for slope overlay.

        e.stopPropagation();
        e.preventDefault();
      });

      $('#' + markers[i].bindTo[j]).on('mouseleave', function(e) {
        // Pan to center when no longer hovering.
        map.closePopup();
        map.setView(centerCoords, 15);
      });
    })
  })

</script>

{{ end }}
